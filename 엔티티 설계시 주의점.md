# 엔티티 설계시 주의점

## 엔티티에는 가급적 Setter를 사용하지 말자

- Setter가 모두 열려있으면?
- 변경 포인트가 너무 많아서, 유지보수가 어렵다.

</br >

## 모든 연관관계는 지연로딩으로 설정하자

- 즉시로딩(EAGER)은 예측이 어렵고, 어떤 SQL이 실행될지 추적하기 어렵다.
  - JPQL을 실행할 때 **N+1 문제**가 발생한다!
- 모든 연관관계는 지연로딩(LAZY)로 설정해야 한다.
- 연관된 엔티티를 함꼐 DB에서 조회할 때, fetch join 또는 엔티티 그래프 기능을 사용하면 된다.
- **@XToOne(@OneToMany, @OneToOne)은 기본 전략이 EAGER기 때문에 LAZY로 바꾸자!**

</br >

## 컬렉션은 필드에서 초기화 하자

- 컬렉션은 필드에서 바로 초기화 하는 것이 안전하다.
- null 문제에서 안전한다
- 하이버네이트는 엔티티를 영속화 할 때, 컬렉션을 감싸서 하이버네이트가 제공하는 내장 컬렉션으로 변경 
  - 만약 getOrders() 처럼 임의의 메서드에서 컬렉션을 잘못 생성하면 하이버네이트 내부 메커니즘에 문제가 발생할 수 있다. 따라서 필드레벨에서 생성하는 것이 가장 안전하고, 코드도 간결하다.

</br >

## 값 타입 참고

- 값 타입은 변경 불가능하게 설계해야 한다.
- **@Setter를 제거하고, 생성자에서 값을 모두 초기화해 변경 불가능 클래스를 만들자!!**
- JPA 스펙상 엔티티나 임베디드 타입은 자바 기본 생성자를 pulbic 또는 protected로 설정해야 한다.
  - public으로 두는 것 보다 protected로 설정하는 것이 더 안전하다
- JPA가 이런 제약을 두는 이유는 **JPA 구현 라이브러리가 객체를 생성할 때 리플렉션 같은 기술을 사용할 수 있도록 지원**해야 하기 떄문이다.